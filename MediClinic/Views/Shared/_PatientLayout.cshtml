@using  MediClinic.Services.Interfaces.SessionManager
@inject ISessionManager _sessionManager

@{
    var curUser = _sessionManager.GetUserId();
}

<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="iMedHealth">
    <meta name="keywords" content="iMedHealth">
    <meta name="author" content="iMedHealth">
    <title>@ViewData["Title"] | Medi Clinic</title>
    <link rel="apple-touch-icon" href="~/app-assets/images/favicon/apple-touch-icon-152x152.png">
    <link rel="shortcut icon" type="image/x-icon" href="~/app-assets/images/favicon/favicon-32x32.png">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- BEGIN: VENDOR CSS-->
    <link href="~/css/animate.css" rel="stylesheet" />
    <link href="~/css/sweetalert2.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="~/app-assets/vendors/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/vendors/fullcalendar/css/fullcalendar.min.css">
    <link href="~/app-assets/vendors/data-tables/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/app-assets/vendors/data-tables/extensions/responsive/css/responsive.dataTables.min.css" rel="stylesheet" />
    <link href="~/app-assets/vendors/data-tables/css/select.dataTables.min.css" rel="stylesheet" />
    <link href="~/app-assets/vendors/flag-icon/css/flag-icon.min.css" rel="stylesheet" />
    <link href="~/app-assets/vendors/dropify/css/dropify.min.css" rel="stylesheet" />
    <link href="~/lib/pnotify.custom.min.css" rel="stylesheet" />
    <link id="linkCss" rel="stylesheet" type="text/css" href="" />

    <!-- END: VENDOR CSS-->
    <!-- BEGIN: Page Level CSS-->
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/themes/vertical-dark-menu-template/materialize.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/themes/vertical-dark-menu-template/style.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/pages/app-calendar.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/pages/app-sidebar.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/pages/app-email.css">
    <link href="~/app-assets/vendors/sweetalert/sweetalert.css" rel="stylesheet" />
    <link href="~/app-assets/css/pages/data-tables.css" rel="stylesheet" />

    <!-- END: Page Level CSS-->
    <!-- BEGIN: Custom CSS-->
    @*<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>*@
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/custom/custom.css">
    <!-- END: Custom CSS-->
    @RenderSection("styles", false)

</head>
<!-- END: Head-->
<body class="vertical-layout page-header-light vertical-menu-collapsible vertical-dark-menu 2-columns  " data-open="click" data-menu="vertical-dark-menu" data-col="2-columns">

    <!-- BEGIN: Header-->
    <partial name="_PatientHeaderLayout" />
    <!-- END: Header-->
    <!-- BEGIN: SideNav-->
    <partial name="_PatientLayoutSideNav" />
    <!-- END: SideNav-->
    <!-- BEGIN: Page Main-->
    <div class="preloader-background">
        <div class="preloader-wrapper big active">
            <div class="spinner-layer spinner-blue-only">
                <div class="circle-clipper left">
                    <div class="circle"></div>
                </div>
                <div class="gap-patch">
                    <div class="circle"></div>
                </div>
                <div class="circle-clipper right">
                    <div class="circle"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="main">
        @RenderBody()
    </div>

    <!-- END: Page Main-->
    <!-- BEGIN: Footer-->
    <partial name="_LayoutFooter" />
    <partial name="_NotificationHub" />
    <!-- END: Footer-->
    <!-- BEGIN VENDOR JS-->

    <script src="~/app-assets/js/vendors.min.js" type="text/javascript"></script>
    <!-- BEGIN VENDOR JS-->
    <!-- BEGIN PAGE VENDOR JS-->
    <script src="~/app-assets/vendors/jquery.nestable/jquery.nestable.js" type="text/javascript"></script>

    <script src="~/app-assets/vendors/fullcalendar/lib/jquery-ui.min.js"></script>
    <script src="~/app-assets/vendors/fullcalendar/lib/moment.min.js"></script>
    <script src="~/app-assets/vendors/fullcalendar/js/fullcalendar.min.js"></script>


    <script src="~/app-assets/vendors/sortable/jquery-sortable-min.js"></script>
    <script src="~/app-assets/vendors/tinymce/tinymce.min.js"></script>
    <script src="~/app-assets/vendors/waypoints/jquery.waypoints.min.js"></script>
    <script src="~/app-assets/vendors/data-tables/js/jquery.dataTables.min.js"></script>
    <script src="~/app-assets/vendors/data-tables/extensions/responsive/js/dataTables.responsive.min.js"></script>
    <link href="~/app-assets/vendors/jquery.nestable/nestable.css" rel="stylesheet" />

    <script src="~/app-assets/vendors/data-tables/js/dataTables.select.min.js"></script>
    <script src="~/app-assets/vendors/dropify/js/dropify.min.js"></script>
    <script src="~/lib/pnotify.custom.min.js"></script>
    <!-- END PAGE VENDOR JS-->
    <!-- BEGIN THEME  JS-->
    @*<script src="~/lib/jquery/dist/jquery.js"></script>*@

    <script src="~/app-assets/js/plugins.js" type="text/javascript"></script>
    <!-- END THEME  JS-->
    <!-- BEGIN PAGE LEVEL JS-->

    <script src="~/app-assets/js/scripts/app-calendar.js" type="text/javascript"></script>
    <script src="~/app-assets/js/scripts/app-email.js" type="text/javascript"></script>
    <script src="~/app-assets/js/scripts/data-tables.js"></script>
    <script src="~/app-assets/vendors/sweetalert/sweetalert.min.js"></script>
    <script src="~/app-assets/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.3/signalr.min.js"></script>
    @RenderSection("scripts", false)
    <!-- END PAGE LEVEL JS-->
    <script src="~/app-assets/js/scripts/form-elements.js"></script>

    <script src="~/app-assets/js/custom/custom-script.js" type="text/javascript"></script>
    <script>

        //$(document).ready(function () {
        //    debugger;
        //    //$('.dropdownauto:before').click(function () {
        //    $('.dropdownauto').click(function () {
        //        debugger;
        //        $(this).find(':input').addClass("focus-visible");
        //        debugger;
        //    });
        //});




    </script>
    <script>
        connection.on("ReceiveMessage", function (user, message) {
            var msg = message.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            var encodedMsg = user + " says " + msg;
            var li = document.createElement("li");
            li.textContent = encodedMsg;
            document.getElementById("messagesList").appendChild(li);
        });
    </script>
    <script src="~/lib/microsoft/signalr/signalr.min.js"></script>
    <script>
        var connection = new signalR.HubConnectionBuilder()
            .withUrl("/NotificationHub")
            .configureLogging(signalR.LogLevel.Information)
            .build();

        connection.start().then(() => {
            connection.on("ReceiveMessage", (userId, articleContent) => {
                debugger;
                 var sessionUserId = @curUser;
                if (userId == sessionUserId) {
                    var date = $.timeago(new Date());
                    $(".notifications-dropdown").append('<li><a href="javascript:void(0);" class="grey-text text-darken-2"><span class="material-icons icon-bg-circle cyan small">add_shopping_cart</span>' + articleContent + '</a><time class="media-meta">' + date + '</time></li>');
                    $('.notification-badge').css('visibility', 'visible');
                }
            });
        });
        const startSignalRConnection = connection => connection.start().then(() => {
            connection.on("ReceiveMessage", (articleContent) => {
                $(".notifications-dropdown").append('<li><a href="javascript:void(0);" class="grey-text text-darken-2"><span class="material-icons icon-bg-circle cyan small">add_shopping_cart</span>' + articleContent + '</a><time class="media-meta">' + date + '</time></li>'); $('.notification-badge').css('visibility', 'visible');
            });
        });
        connection.onclose(() => setTimeout(startSignalRConnection(connection), 5000));
    </script>
</body>
</html>